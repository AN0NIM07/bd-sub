<!DOCTYPE html>
<html>
<head>
  <title>BD Nomination Data</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      padding: 20px;
      margin: 0;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .search-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .search-container input {
      padding: 8px;
      width: 300px;
      font-size: 16px;
    }
    .search-container button {
      padding: 9px 15px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007BFF;
      border: none;
      color: white;
      border-radius: 4px;
      margin-left: 5px;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      padding: 20px;
      justify-content: center; /* Center when few items */
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      overflow: hidden;
      transition: transform 0.2s;
      max-width: 400px; /* Optimal size for single card */
      width: 100%;
      margin: 0 auto;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .card-content {
      padding: 15px;
    }
    .card img {
      width: 100%;
      height: 200px; /* fixed height for uniform card size */
      object-fit: cover; /* scale image while maintaining aspect ratio */
      margin-bottom: 10px;
    }
    .decision {
      font-weight: bold;
      padding: 5px 0;
      font-size: 16px;
    }
    .accept-bg {
      background: rgba(0, 200, 0, 0.08);
    }
    .reject-bg {
      background: rgba(255, 0, 0, 0.08);
    }
    .duplicate-bg {
      background: rgba(0, 123, 255, 0.08);
    }
    .decision.accept {
      color: green;
    }
    .decision.reject {
      color: red;
    }
    .decision.duplicate {
      color: blue;
    }
  </style>
</head>
<body>
  <h2>Google Sheet Data</h2>
  <div class="search-container">
    <input type="text" id="searchBox" placeholder="Search by Nomination Name">
    <button onclick="searchData()">Search</button>
    <button onclick="clearSearch()">Clear</button>
  </div>
  <div class="container" id="data-container"></div>

  <script>
    const sheetURL = "https://script.google.com/macros/s/AKfycbwIWDquwiWsRm1A1qhPrhIa8aWUOAj_UmhP-gCvkxeRrL8rFcqRzOmEbIB_mtmv8BxR3w/exec";
    let allData = [];

    async function fetchData() {
      try {
        const res = await fetch(sheetURL);
        const data = await res.json();
        allData = data.reverse(); // newest first
        displayData(allData.slice(0, 50)); // first load: last 50 entries
      } catch (err) {
        console.error("Error fetching data:", err);
      }
    }

    function displayData(data) {
      const container = document.getElementById("data-container");
      container.innerHTML = "";

      data.forEach(item => {
        if (!["ACCEPT", "REJECT", "DUPLICATE"].includes(item.Decision)) return;

        let bgClass = "";
        let decisionClass = "";
        if (item.Decision === "ACCEPT") {
          bgClass = "accept-bg";
          decisionClass = "accept";
        } else if (item.Decision === "REJECT") {
          bgClass = "reject-bg";
          decisionClass = "reject";
        } else if (item.Decision === "DUPLICATE") {
          bgClass = "duplicate-bg";
          decisionClass = "duplicate";
        }

        let actionsText = "";
        if (item.Decision === "REJECT" && item.Actions) {
          actionsText = `<p><strong>Actions:</strong> ${item.Actions}</p>`;
        }

        const card = `
          <div class="card ${bgClass}">
            ${item.MainPic ? `<img src="${item.MainPic}" alt="Main Picture">` : ""}
            ${item.SupPic ? `<img src="${item.SupPic}" alt="Supporting Picture">` : ""}
            <div class="card-content">
              <p><strong>Nomination Name:</strong> ${item.NominationName}</p>
              <p class="decision ${decisionClass}"><strong>Decision:</strong> ${item.Decision}</p>
              ${actionsText}
            </div>
          </div>
        `;
        container.innerHTML += card;
      });
    }

    function searchData() {
      const searchValue = document.getElementById("searchBox").value.trim().toLowerCase();
      const filtered = allData.filter(item =>
        item.NominationName && item.NominationName.toLowerCase().includes(searchValue) &&
        ["ACCEPT", "REJECT", "DUPLICATE"].includes(item.Decision)
      );
      displayData(filtered);
    }

    function clearSearch() {
      document.getElementById("searchBox").value = "";
      displayData(allData.slice(0, 50)); // reset to last 50 entries
    }

    fetchData();
  </script>
</body>
</html>
